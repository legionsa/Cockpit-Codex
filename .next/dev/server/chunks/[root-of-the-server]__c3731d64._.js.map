{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/lion/Documents/%5B01%5D%20Projects/Cockpit%20Codex/src/app/api/pages/%5Bid%5D/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { promises as fs } from 'fs';\nimport path from 'path';\nimport type { Page } from '@/lib/pages';\n\nconst pagesDir = path.join(process.cwd(), 'src/data/pages');\nconst redirectsPath = path.join(process.cwd(), 'src/data/redirects.json');\n\n// GET /api/pages/[id] - Get single page\nexport async function GET(request: Request) {\n  const id = request.url.split('/').pop()!;\n  try {\n    const content = await fs.readFile(\n      path.join(pagesDir, `${id}.json`),\n      'utf8'\n    );\n    return NextResponse.json(JSON.parse(content));\n  } catch {\n    return NextResponse.json(\n      { error: 'Page not found' },\n      { status: 404 }\n    );\n  }\n}\n\n// PUT /api/pages/[id] - Update page\nexport async function PUT(request: Request) {\n  const id = request.url.split('/').pop()!;\n  const data = await request.json();\n  const filePath = path.join(pagesDir, `${id}.json`);\n\n  try {\n    const content = await fs.readFile(filePath, 'utf8');\n    const existingPage = JSON.parse(content);\n\n    // If moving to a new parent, handle redirects\n    if (data.parentId !== existingPage.parentId) {\n      const redirectsContent = await fs.readFile(redirectsPath, 'utf8');\n      const redirects = JSON.parse(redirectsContent);\n      \n      redirects.push({\n        from: `/${existingPage.slug}`,\n        to: `/${data.parentId ? `${data.parentId}/` : ''}${data.slug || existingPage.slug}`\n      });\n\n      await fs.writeFile(redirectsPath, JSON.stringify(redirects, null, 2));\n    }\n\n    const updatedPage: Page = {\n      ...existingPage,\n      ...data,\n      id, // Prevent ID changes\n      lastUpdated: new Date().toISOString()\n    };\n\n    await fs.writeFile(filePath, JSON.stringify(updatedPage, null, 2));\n    return NextResponse.json(updatedPage);\n  } catch {\n    return NextResponse.json(\n      { error: 'Page not found' },\n      { status: 404 }\n    );\n  }\n}\n\n// DELETE /api/pages/[id] - Archive page\nexport async function DELETE(request: Request) {\n  const id = request.url.split('/').pop()!;\n  const filePath = path.join(pagesDir, `${id}.json`);\n\n  try {\n    const content = await fs.readFile(filePath, 'utf8');\n    const page = JSON.parse(content);\n\n    // Soft delete by updating status\n    const archivedPage = {\n      ...page,\n      status: 'Archived',\n      lastUpdated: new Date().toISOString()\n    };\n\n    await fs.writeFile(filePath, JSON.stringify(archivedPage, null, 2));\n    return NextResponse.json(archivedPage);\n  } catch {\n    return NextResponse.json(\n      { error: 'Page not found' },\n      { status: 404 }\n    );\n  }\n}"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;;;;AAGA,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAC1C,MAAM,gBAAgB,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAGxC,eAAe,IAAI,OAAgB;IACxC,MAAM,KAAK,QAAQ,GAAG,CAAC,KAAK,CAAC,KAAK,GAAG;IACrC,IAAI;QACF,MAAM,UAAU,MAAM,yGAAE,CAAC,QAAQ,CAC/B,4GAAI,CAAC,IAAI,CAAC,UAAU,GAAG,GAAG,KAAK,CAAC,GAChC;QAEF,OAAO,gJAAY,CAAC,IAAI,CAAC,KAAK,KAAK,CAAC;IACtC,EAAE,OAAM;QACN,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAiB,GAC1B;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,IAAI,OAAgB;IACxC,MAAM,KAAK,QAAQ,GAAG,CAAC,KAAK,CAAC,KAAK,GAAG;IACrC,MAAM,OAAO,MAAM,QAAQ,IAAI;IAC/B,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,UAAU,GAAG,GAAG,KAAK,CAAC;IAEjD,IAAI;QACF,MAAM,UAAU,MAAM,yGAAE,CAAC,QAAQ,CAAC,UAAU;QAC5C,MAAM,eAAe,KAAK,KAAK,CAAC;QAEhC,8CAA8C;QAC9C,IAAI,KAAK,QAAQ,KAAK,aAAa,QAAQ,EAAE;YAC3C,MAAM,mBAAmB,MAAM,yGAAE,CAAC,QAAQ,CAAC,eAAe;YAC1D,MAAM,YAAY,KAAK,KAAK,CAAC;YAE7B,UAAU,IAAI,CAAC;gBACb,MAAM,CAAC,CAAC,EAAE,aAAa,IAAI,EAAE;gBAC7B,IAAI,CAAC,CAAC,EAAE,KAAK,QAAQ,GAAG,GAAG,KAAK,QAAQ,CAAC,CAAC,CAAC,GAAG,KAAK,KAAK,IAAI,IAAI,aAAa,IAAI,EAAE;YACrF;YAEA,MAAM,yGAAE,CAAC,SAAS,CAAC,eAAe,KAAK,SAAS,CAAC,WAAW,MAAM;QACpE;QAEA,MAAM,cAAoB;YACxB,GAAG,YAAY;YACf,GAAG,IAAI;YACP;YACA,aAAa,IAAI,OAAO,WAAW;QACrC;QAEA,MAAM,yGAAE,CAAC,SAAS,CAAC,UAAU,KAAK,SAAS,CAAC,aAAa,MAAM;QAC/D,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAM;QACN,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAiB,GAC1B;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,OAAO,OAAgB;IAC3C,MAAM,KAAK,QAAQ,GAAG,CAAC,KAAK,CAAC,KAAK,GAAG;IACrC,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,UAAU,GAAG,GAAG,KAAK,CAAC;IAEjD,IAAI;QACF,MAAM,UAAU,MAAM,yGAAE,CAAC,QAAQ,CAAC,UAAU;QAC5C,MAAM,OAAO,KAAK,KAAK,CAAC;QAExB,iCAAiC;QACjC,MAAM,eAAe;YACnB,GAAG,IAAI;YACP,QAAQ;YACR,aAAa,IAAI,OAAO,WAAW;QACrC;QAEA,MAAM,yGAAE,CAAC,SAAS,CAAC,UAAU,KAAK,SAAS,CAAC,cAAc,MAAM;QAChE,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAM;QACN,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAiB,GAC1B;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}